<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

</head>
<body>
    <div id="message"></div>
    <div id="calculator">
        <div id="display-box">
            <div id="equation"></div>
            <div id="result"></div>
        </div>
        <div class="button-box">
            <div class="button-row">
                <button class="digit" id="7">7</button>
                <button class="digit" id="8">8</button>
                <button class="digit" id="9">9</button>
                <button class="operation" id="divide">&divide</button>
            </div>
            <div class="button-row">
                <button class="digit" id="4">4</button>
                <button class="digit" id="5">5</button>
                <button class="digit" id="6">6</button>
                <button class="operation" id ="multiply">&times</button>
            </div>
            
            <div class="button-row">
                <button class="digit" id="1">1</button>
                <button class="digit" id="2">2</button>
                <button class="digit" id="3">3</button>
                <button class="operation" id="subtract">-</button>
            </div>

            <div class="button-row">
                <button class="digit" id="0">0</button>
                <button class="other" id="equal">=</button>
                <button class="other" id="clear">C</button>
                <button class="operation" id="add">+</button>
            </div>
        </div>
    </div>

    <script>
        let firstOperand = "";
        let secondOperand = "";
        let currentInput = "";
        let operator = "";
        let result = "";

        let numButtons = document.querySelectorAll(".digit");
        numButtons.forEach((button) => {
            button.addEventListener("click", () => {
                if (result != "")
                    clearAll();
                currentInput = currentInput + button.id;
                displayEquation();
            });
        });

        let operatorButtons = document.querySelectorAll(".operation");
        operatorButtons.forEach((button) => {
            button.addEventListener("click", () => {
                // no input, no operator -> nothing
                if (currentInput == "" && firstOperand == "") {}
                // no result, no operator (normal) -> update first input, operator
                else if (result == "" && operator == "") {
                    firstOperand = currentInput;
                    currentInput = "";
                    operator = button.id;
                }
                // no result, but an operator -> just want to change operator
                else if (result == "" && operator != "" && currentInput == "") {
                    currentInput = "";
                    operator = button.id;
                }
                // no result, yes operator, have current input
                else if (result == "" && operator != "" && currentInput != "") {}
                // result is non-empty, we want to chain.
                else if (result != "") {
                    firstOperand = result;
                    result = "";
                    currentInput = "";
                    operator = button.id;
                }
                displayEquation();
                displayResult();
            });
        });

        let equalButton = document.querySelector("#equal");
        equalButton.addEventListener("click", () => {
            if(operator == "") {
                result = currentInput;
            } else if (operator != "" && currentInput == "") {
                displayMessage("equal error");
            } else {
            secondOperand = currentInput;
            currentInput = "";
            operate(firstOperand, secondOperand, operator);
            }
        });

        let clearButton = document.querySelector("#clear");
        clearButton.addEventListener("click", clearAll);

        function clearAll() {
            firstOperand = "";
            secondOperand = "";
            currentInput = "";
            operator = "";
            result = "";
            displayEquation();
            displayResult();
        }

        function operate(firstOperand, secondOperand, operator) {
            switch (operator) {
                case "add":
                    result = parseInt(firstOperand) + parseInt(secondOperand);
                    break;
                case "subtract":
                    result = parseInt(firstOperand) - parseInt(secondOperand);
                    break;
                case "multiply":
                    result = parseInt(firstOperand) * parseInt(secondOperand);
                    break;
                case "divide":
                    if (secondOperand == 0)
                       displayMessage("zero error");
                    else 
                        result = parseInt(firstOperand) / parseInt(secondOperand);
                    break;
            }
            displayResult();
        }

        function operatorToSymbol(string) {
            switch (string) {
                case "add":
                    return " + ";
                    break;
                case "subtract":
                    return " - ";
                    break;
                case "divide":
                    return " / ";
                    break;
                case "multiply":
                    return " * ";
                    break;
            }
        }

        function displayEquation() {
            let displayStr = "";

            if (firstOperand == "") 
                displayStr = currentInput;
            if (operator != "" && currentInput == "") {
                displayStr = firstOperand + operatorToSymbol(operator);
            }
            if (operator != "" && currentInput != "") {
                displayStr = firstOperand + operatorToSymbol(operator) + currentInput;
            }
            document.querySelector("#equation").textContent = displayStr;
        }

        function displayResult() {
            document.querySelector("#result").textContent = result;
        }

        function displayMessage(message) {
            document.querySelector("#message").textContent = message;
            setTimeout(function(){
                document.querySelector("#message").textContent = ""}, 5000
            );
        }

    </script>
</body>
</html>