<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Calculator App</title>
    <link rel="icon" href="/calc.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

</head>
<body>
    <div id="message"></div>
    <div id="calculator">
        <div id="display-box">
            <div id="equation"></div>
            <div id="result"></div>
        </div>
        <div class="button-box">
            <div class="button-row">
                <button class="digit" id="7">7</button>
                <button class="digit" id="8">8</button>
                <button class="digit" id="9">9</button>
                <button class="operation" id="divide">&divide</button>
            </div>
            <div class="button-row">
                <button class="digit" id="4">4</button>
                <button class="digit" id="5">5</button>
                <button class="digit" id="6">6</button>
                <button class="operation" id ="multiply">&times</button>
            </div>
            
            <div class="button-row">
                <button class="digit" id="1">1</button>
                <button class="digit" id="2">2</button>
                <button class="digit" id="3">3</button>
                <button class="operation" id="subtract">-</button>
            </div>

            <div class="button-row">
                <button class="digit" id="0">0</button>
                <button class="other" id="equal">=</button>
                <button class="other" id="clear">C</button>
                <button class="operation" id="add">+</button>
            </div>
        </div>
    </div>

    <script>
        let firstOperand = "";
        let secondOperand = "";
        let currentInput = "";
        let operator = "";
        let result = "";

        let numButtons = document.querySelectorAll(".digit");
        numButtons.forEach((button) => {
            button.addEventListener("click", () => handleNumberPress(button.id));
        });

        let operatorButtons = document.querySelectorAll(".operation");
        operatorButtons.forEach((button) => {
            button.addEventListener("click", () => handleOperatorPress(button.id));
        });

        let equalButton = document.querySelector("#equal");
        equalButton.addEventListener("click", () => handleEqualPress());

        let clearButton = document.querySelector("#clear");
        clearButton.addEventListener("click", clearAll);

        let bodySection = document.querySelector("body");
        bodySection.addEventListener('keydown', (e) => {
            const numberString = "1234567890";
            const operationsString = "/x+-*"
            
            if (numberString.includes(e.key)) 
                handleNumberPress(e.key);
            else if (operationsString.includes(e.key))
                handleOperatorPress(symbolToOperator(e.key));
            else if (e.key == "=" || e.key == "Enter")
                handleEqualPress();
        });

        function handleNumberPress(number) {
            if (result != "")
                clearAll();
            currentInput = currentInput + number;
                displayEquation();
        }

        function handleOperatorPress(passedIn) {
            if (currentInput == "" && firstOperand == "") {}
            else if (result == "" && operator == "") {
                firstOperand = currentInput;
                currentInput = "";
                operator = passedIn;
            } else if (result == "" && operator != "" && currentInput == "") {
                currentInput = "";
                operator = passedIn;
            } else if (result == "" && operator != "" && currentInput != "") {
            } else if (result != "") {
                firstOperand = result;
                result = "";
                currentInput = "";
                operator = passedIn;
            }
            displayEquation();
            displayResult();
        }

        function handleEqualPress() {
            if(operator == "") {
                result = currentInput;
                displayResult();
            } else if (operator != "" && currentInput == "" && result != "") {
                firstOperand = result;
                operate(firstOperand, secondOperand, operator);
            } else if (operator != "" && currentInput == "" && result == "") {
                displayMessage("Error: No second operand.");
            } else {
                secondOperand = currentInput;
                currentInput = "";
                operate(firstOperand, secondOperand, operator);
            }
        }

        function clearAll() {
            firstOperand = "";
            secondOperand = "";
            currentInput = "";
            operator = "";
            result = "";
            displayEquation();
            displayResult();
        }

        function operate(firstOperand, secondOperand, operator) {
            switch (operator) {
                case "add":
                    result = parseFloat(firstOperand) + parseFloat(secondOperand);
                    break;
                case "subtract":
                    result = parseFloat(firstOperand) - parseFloat(secondOperand);
                    break;
                case "multiply":
                    result = parseFloat(firstOperand) * parseFloat(secondOperand);
                    break;
                case "divide":
                    if (secondOperand == 0) {
                       displayMessage("You can't divide by zero!");
                       clearAll();
                    } else
                        result = parseFloat(firstOperand) / parseFloat(secondOperand);
                    break;
            }
            displayResult();
        }

        function operatorToSymbol(string) {
            switch (string) {
                case "add":
                    return " + ";
                    break;
                case "subtract":
                    return " - ";
                    break;
                case "divide":
                    return " / ";
                    break;
                case "multiply":
                    return " * ";
                    break;
            }
        }

        function symbolToOperator(string) {
            switch(string) {
                case "+":
                    return "add";
                    break;
                case "-": 
                    return "subtract";
                    break;
                case "/":
                    return "divide";
                    break;
                case "x":
                case "*":
                    return "multiply";
                    break;
            }
        }

        function displayEquation() {
            let displayStr = "";

            if (firstOperand == "") 
                displayStr = currentInput;
            if (operator != "" && currentInput == "") {
                displayStr = firstOperand + operatorToSymbol(operator);
            } if (operator != "" && currentInput != "") {
                displayStr = firstOperand + operatorToSymbol(operator) + currentInput;
            } if (displayStr.length > 14) {
                displayMessage("Your equation is too long to display!");
                displayStr = displayStr.substring(0, 14);
            }
            document.querySelector("#equation").textContent = displayStr;
        }

        function displayResult() {
            let resultToDisplay = result;
            if (result.toString().length > 7) {
                if (Number.isInteger(parseFloat(result))) {
                    let startRes = result.toString().substring(0, 4);
                    let endRes = result.toString().substring(4);
                    result = (startRes * (10 ** endRes.length)).toExponential();
                    resultToDisplay = result;
                    displayMessage("Your result is too large to display!");
                } else
                    resultToDisplay = result.toString().substring(0,7);
            }
            document.querySelector("#result").textContent = resultToDisplay;
        }

        function displayMessage(message) {
            document.querySelector("#message").textContent = message;
            setTimeout(function() {document.querySelector("#message").textContent = ""}, 3000);
        }

    </script>
</body>
</html>